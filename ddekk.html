<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard Input</title>
<style>
/* ===== GLOBAL ===== */
* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #e6f0ff; /* Biru muda pemerintahan */
    color: #1e3a8a; /* Biru tua */
}

/* ===== CONTAINER ===== */
.container {
    max-width: 900px;
    margin: 40px auto;
    background: #ffffff; /* putih */
    border-radius: 12px;
    padding: 30px 40px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.2);
}

/* ===== HEADINGS ===== */
h1 {
    text-align: center;
    color: #1e3a8a;
    font-size: 28px;
    margin-bottom: 25px;
}

/* ===== TIMESTAMP ===== */
.timestamp {
    text-align: right;
    font-size: 13px;
    color: #475569; /* abu gelap */
    margin-bottom: 15px;
}

/* ===== FORM GRID ===== */
.form-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 15px;
}
.form-grid.full-width {
    grid-template-columns: 1fr;
}

/* ===== FORM ELEMENTS ===== */
input, select, textarea, button {
    width: 100%;
    padding: 12px 15px;
    border-radius: 8px;
    font-size: 15px;
    border: 1px solid #cbd5e1; /* abu muda */
}
input, select, textarea {
    background: #f1f5f9; /* abu muda */
    color: #1e3a8a;
}
textarea {
    min-height: 100px;
    resize: vertical;
}

/* ===== BUTTON ===== */
button {
    background: #1e40af; /* biru tua */
    color: #ffffff;
    font-weight: bold;
    font-size: 16px;
    cursor: pointer;
    transition: 0.3s;
}
button:hover {
    background: #1e3a8a;
}

/* ===== FOTO PREVIEW ===== */
.preview-container {
    margin-top: 15px;
    border: 2px dashed #cbd5e1;
    border-radius: 12px;
    padding: 20px;
    background: #f8fafc;
    text-align: center;
    min-height: 220px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
}

.preview-container:hover {
    border-color: #1e40af;
    background: #eff6ff;
}

.preview-placeholder {
    color: #94a3b8;
    font-size: 14px;
}

.preview-placeholder svg {
    width: 64px;
    height: 64px;
    margin-bottom: 10px;
    opacity: 0.5;
}

#previewFoto {
    max-width: 100%;
    max-height: 300px;
    border-radius: 8px;
    object-fit: contain;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

/* ===== RESPONSIVE ===== */
@media(max-width: 768px){
    .form-grid {
        grid-template-columns: 1fr;
    }
}
</style>
</head>
<body>

<div class="container">
    <div style="margin-bottom: 20px;">
        <button onclick="window.location.href='dashboard.html'" style="width: auto; padding: 10px 20px; background: #64748b; font-size: 14px;">
            ‚Üê Kembali ke Dashboard
        </button>
    </div>
    <h1>Job Activity Dashboard</h1>
    <div class="timestamp" id="timestamp"></div>

    <div class="form-grid">
        <div>
            <label>Nama Pegawai</label>
            <input id="nama" type="text" placeholder="Nama Pegawai">
        </div>
        <div>
            <label>Area Pekerjaan</label>
            <input id="area" type="text" placeholder="Lokasi / Area">
        </div>
    </div>

    <div class="form-grid">
        <div>
            <label>Jenis Pekerjaan</label>
            <select id="jenis">
                <option disabled selected>Pilih Jenis</option>
                <option>Maintenance</option>
                <option>Instalasi</option>
                <option>Perbaikan</option>
            </select>
        </div>
        <div>
            <label>Rentang Waktu</label>
            <div style="display:flex; gap:10px;">
                <select id="waktuMulai"></select>
                <select id="waktuSelesai"></select>
            </div>
        </div>
    </div>

    <div class="form-grid full-width">
        <div>
            <label>Upload Bukti Foto (Selfie)</label>
            <input id="foto" type="file" accept="image/*" capture="user">
            <div class="preview-container" id="previewContainer">
                <div class="preview-placeholder" id="placeholder">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                    <div>Belum ada foto dipilih</div>
                    <small>Klik "Choose File" untuk upload</small>
                </div>
                <img id="previewFoto" alt="Preview Foto" style="display:none;">
            </div>
            <small style="color:#475569; display:block; margin-top:8px;">Pastikan foto selfie Anda saat bekerja</small>
        </div>
    </div>

    <div class="form-grid full-width">
        <div>
            <label>Deskripsikan Pekerjaan</label>
            <textarea id="desc" placeholder="Deskripsikan pekerjaan yang sedang atau telah Anda lakukan"></textarea>
        </div>
    </div>

    <button onclick="kirim()">Kirim Data</button>
</div>

<script>
    // ===== TIMESTAMP OTOMATIS =====
    const timestampEl = document.getElementById("timestamp");
    function updateTimestamp() {
        const now = new Date();
        timestampEl.textContent = "Timestamp: " + now.toLocaleString('id-ID', { hour12:false });
    }
    setInterval(updateTimestamp, 1000);
    updateTimestamp();

    // ===== GENERATE JAM LIST =====
    const mulai = document.getElementById("waktuMulai");
    const selesai = document.getElementById("waktuSelesai");
    for(let h=0; h<24; h++){
        const jam = h.toString().padStart(2,'0') + ":00";
        const optMulai = document.createElement("option");
        optMulai.value = jam;
        optMulai.textContent = jam;
        mulai.appendChild(optMulai);

        const optSelesai = document.createElement("option");
        optSelesai.value = jam;
        optSelesai.textContent = jam;
        selesai.appendChild(optSelesai);
    }

    // ===== PREVIEW FOTO =====
    const fotoInput = document.getElementById("foto");
    const previewFoto = document.getElementById("previewFoto");
    const placeholder = document.getElementById("placeholder");
    
    fotoInput.addEventListener("change", () => {
        const file = fotoInput.files[0];
        if(file){
            const reader = new FileReader();
            reader.onload = e => { 
                previewFoto.src = e.target.result;
                previewFoto.style.display = "block";
                placeholder.style.display = "none";
            };
            reader.readAsDataURL(file);
        } else {
            previewFoto.src = "";
            previewFoto.style.display = "none";
            placeholder.style.display = "block";
        }
    });

    // ===== KIRIM DATA =====
    async function kirim() {
        const nama = document.getElementById("nama").value;
        const area = document.getElementById("area").value;
        const jenis = document.getElementById("jenis").value;
        const waktuMulai = document.getElementById("waktuMulai").value;
        const waktuSelesai = document.getElementById("waktuSelesai").value;
        const desc = document.getElementById("desc").value;
        const foto = document.getElementById("foto").files[0];

        if(!nama || !area || !jenis || !waktuMulai || !waktuSelesai || !desc || !foto){
            alert("Semua field harus diisi dan foto harus diupload!");
            return;
        }

        // Kirim ke server lokal
        const formData = new FormData();
        const now = new Date().toISOString();
        formData.append("timestamp", now);
        formData.append("nama", nama);
        formData.append("area", area);
        formData.append("jenis", jenis);
        formData.append("waktuMulai", waktuMulai);
        formData.append("waktuSelesai", waktuSelesai);
        formData.append("desc", desc);
        formData.append("foto", foto);

        try {
            const response = await fetch("/submit-absensi", {
                method: "POST",
                body: formData
            });

            const result = await response.json();
            
            if(result.success) {
                alert("Data absensi berhasil disimpan!\n" + 
                      "Nama: " + nama + "\n" +
                      "Waktu: " + waktuMulai + " - " + waktuSelesai);
                
                // RESET FORM
                document.getElementById("nama").value = "";
                document.getElementById("area").value = "";
                document.getElementById("jenis").selectedIndex = 0;
                document.getElementById("waktuMulai").selectedIndex = 0;
                document.getElementById("waktuSelesai").selectedIndex = 0;
                document.getElementById("desc").value = "";
                fotoInput.value = "";
                previewFoto.src = "";
                previewFoto.style.display = "none";
                placeholder.style.display = "block";
            } else {
                alert("Gagal menyimpan data: " + result.message);
            }
        } catch (error) {
            alert("Terjadi kesalahan: " + error.message);
            console.error(error);
        }
    }
</script>

</body>
</html>
